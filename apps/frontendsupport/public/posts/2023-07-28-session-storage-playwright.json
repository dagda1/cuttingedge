{
  "html": "<p><a href=https://playwright.dev/>Playwright</a> is my choice for end-to-end (e2e) testing. A common problem in any end-to-end testing framework is authenticating or logging in a user before each test. However, Playwright has a great solution by giving an API to store the authenticated browser state in the page context's <a href=https://playwright.dev/docs/api/class-apirequestcontext#api-request-context-storage-state>storageState</a>. The <code>storageState</code> contains a snapshot of the current cookies and localStorage.<p>If this authenticated browser state, e.g. an authentication token, is stored in localStorage or cookies, then Playright <a href=https://playwright.dev/docs/auth#core-concepts>has you covered</a>.<p>If, however, you use <code>sessionStorage</code>, then unfortunately, this is not covered. The <a href=https://playwright.dev/docs/auth#session-storage>docs</a> say that using sessionStoarge to store authentication tokens is rare, which differs from my experience.<p>The docs do, though, give a <a href=https://playwright.dev/docs/auth#session-storage>code snippet</a>(below) that took me a while to understand, and it is really two snippets, one for persisting the sessionStorage and one for rehydrating the sessionStorage before each test.<pre class=language-ts><code class=\"language-ts code-highlight\"><span class=code-line><span class=\"token comment\">// Get session storage and store as env variable</span>\n</span><span class=code-line><span class=\"token keyword\">const</span> sessionStorage <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">evaluate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n</span><span class=code-line>  <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>sessionStorage<span class=\"token punctuation\">)</span>\n</span><span class=code-line><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line>fs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span>\n</span><span class=code-line>  <span class=\"token string\">\"playwright/.auth/session.json\"</span><span class=\"token punctuation\">,</span>\n</span><span class=code-line>  <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>sessionStorage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n</span><span class=code-line>  <span class=\"token string\">\"utf-8\"</span>\n</span><span class=code-line><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line>\n</span><span class=code-line><span class=\"token comment\">// Set session storage in a new context</span>\n</span><span class=code-line><span class=\"token keyword\">const</span> sessionStorage <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>\n</span><span class=code-line>  fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"playwright/.auth/session.json\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">)</span>\n</span><span class=code-line><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line><span class=\"token keyword\">await</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">addInitScript</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>storage<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n</span><span class=code-line>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>hostname <span class=\"token operator\">===</span> <span class=\"token string\">\"example.com\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n</span><span class=code-line>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">]</span> <span class=\"token keyword\">of</span> object<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span>storage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</span><span class=code-line>      window<span class=\"token punctuation\">.</span>sessionStorage<span class=\"token punctuation\">.</span><span class=\"token function\">setItem</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line>  <span class=\"token punctuation\">}</span>\n</span><span class=code-line><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> sessionStorage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></code></pre><p>I will give step-by-step instructions that remove the confusion and ambiguity.<h2>Project references</h2><p>The first step in persisting authentication state across tests is to create a test that logs the user in and uses <a href=https://playwright.dev/docs/next/test-projects#dependencies>Playright project dependencies</a> to ensure that the login test runs before any other.<p>Project dependencies are a list of projects that need to run before the tests in another project run.<div class=remark-code-title>./playwright.config.ts</div><pre class=language-ts><code class=\"language-ts code-highlight\"><span class=code-line>projects<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n</span><span class=code-line>  <span class=\"token punctuation\">{</span>\n</span><span class=code-line>    name<span class=\"token operator\">:</span> <span class=\"token string\">'setup'</span><span class=\"token punctuation\">,</span>\n</span><span class=code-line>    testMatch<span class=\"token operator\">:</span> <span class=\"token string\">'**/*.setup.ts'</span><span class=\"token punctuation\">,</span>\n</span><span class=code-line>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n</span><span class=code-line>  <span class=\"token punctuation\">{</span>\n</span><span class=code-line>    name<span class=\"token operator\">:</span> <span class=\"token string\">'e2e tests logged in'</span><span class=\"token punctuation\">,</span>\n</span><span class=code-line>    testMatch<span class=\"token operator\">:</span> <span class=\"token string\">'**/*.spec.ts'</span><span class=\"token punctuation\">,</span>\n</span><span class=code-line>    dependencies<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'setup'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n</span><span class=code-line>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n</span><span class=code-line><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n</span></code></pre><p>With this configuration, any tests that match the <code>'**/*.setup.ts'</code> glob will run before any tests that match the <code>'**/*.spec.ts'</code> glob.<h2>Store authentication state in sessionStorage</h2><p>Below is the test file, <code>login.setup.ts</code>, that logs the user in:<pre class=language-ts><code class=\"language-ts code-highlight\"><span class=\"code-line line-number highlight-line\"line=1><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> test <span class=\"token keyword\">as</span> setup<span class=\"token punctuation\">,</span> expect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@playwright/test\"</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line line-number\"line=2><span class=\"token keyword\">import</span> fs <span class=\"token keyword\">from</span> <span class=\"token string\">\"fs\"</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line line-number\"line=3>\n</span><span class=\"code-line line-number highlight-line\"line=4><span class=\"token keyword\">const</span> <span class=\"token constant\">STORAGE_STATE</span> <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"playwright/.auth/auth.json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line line-number\"line=5>\n</span><span class=\"code-line line-number\"line=6><span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"authenticate\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> page <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n</span><span class=\"code-line line-number\"line=7>  <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">goto</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line line-number\"line=8>  <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"textbox\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"SOEID\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line line-number\"line=9>  <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"textbox\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"Password\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line line-number\"line=10>  <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span>keyboard<span class=\"token punctuation\">.</span><span class=\"token function\">press</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Enter\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line line-number\"line=11>\n</span><span class=\"code-line line-number\"line=12>  <span class=\"token keyword\">await</span> <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">.</span><span class=\"token function\">locator</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[href*=\"/parodos\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line line-number\"line=13>\n</span><span class=\"code-line line-number highlight-line\"line=14>  <span class=\"token keyword\">const</span> sessionStorage <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">evaluate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n</span><span class=\"code-line line-number highlight-line\"line=15>    <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>sessionStorage<span class=\"token punctuation\">)</span>\n</span><span class=\"code-line line-number highlight-line\"line=16>  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line line-number highlight-line\"line=17>\n</span><span class=\"code-line line-number highlight-line\"line=18>  fs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span><span class=\"token constant\">STORAGE_STATE</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>sessionStorage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line line-number highlight-line\"line=19><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></code></pre><p>I've aliased the Playwright <code>test</code> object to <code>setup</code> to make it clear that this test is different from the rest:<pre class=language-ts><code class=\"language-ts code-highlight\"><span class=code-line><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> test <span class=\"token keyword\">as</span> setup<span class=\"token punctuation\">,</span> expect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@playwright/test\"</span><span class=\"token punctuation\">;</span>\n</span></code></pre><p>The first task in persisting the sessionStorage is to persist a snapshot of the current sessionStorage to a file at the following location:<pre class=language-ts><code class=\"language-ts code-highlight\"><span class=code-line><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token constant\">STORAGE_STATE</span> <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"playwright/.auth/auth.json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></code></pre><p>After the test runs, the following code retrieves the sessionStorage state and saves it to a file in the path specified above:<pre class=language-ts><code class=\"language-ts code-highlight\"><span class=code-line><span class=\"token keyword\">const</span> sessionStorage <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">evaluate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n</span><span class=code-line>  <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>sessionStorage<span class=\"token punctuation\">)</span>\n</span><span class=code-line><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line>\n</span><span class=code-line>fs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span><span class=\"token constant\">STORAGE_STATE</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>sessionStorage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></code></pre><p><a href=https://playwright.dev/docs/evaluating>page.evaluate()</a> can execute the javascript to retrieve the current sessionStorage state from the browser.<h2>Rehydrating sessionStorage before each test</h2><p>We want to avoid copying and pasting similar code in each test that requires the user to be logged in. We want to avoid including the code to read in the file and setting the sessionStorage in every test without resorting to sloppy copy and paste.<p>Playwright's <a href=https://playwright.dev/docs/test-fixtures>fixtures</a> establish an environment for each test, giving the test everything it needs<p>Below is the <code>sessionStorage.ts</code> fixture that retrieves the previously saved sessionStorage state from the file and then initializes the browser sessionStorage with the JSON in the file.<div class=remark-code-title>sessionStorage.ts</div><pre class=language-ts><code class=\"language-ts code-highlight\"><span class=code-line><span class=\"token keyword\">import</span> fs <span class=\"token keyword\">from</span> <span class=\"token string\">'fs'</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> test <span class=\"token keyword\">as</span> base <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@playwright/test'</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">STORAGE_STATE</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../playwright.config'</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line>\n</span><span class=code-line><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> test <span class=\"token operator\">=</span> base<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n</span><span class=code-line>  <span class=\"token function function-variable\">context</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> context <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> use<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n</span><span class=code-line>    <span class=\"token keyword\">const</span> sessionStorage <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token constant\">STORAGE_STATE</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line>\n</span><span class=code-line>    <span class=\"token keyword\">await</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">addInitScript</span><span class=\"token punctuation\">(</span>storage <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n</span><span class=code-line>      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">]</span> <span class=\"token keyword\">of</span> object<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>storage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n</span><span class=code-line>        window<span class=\"token punctuation\">.</span>sessionStorage<span class=\"token punctuation\">.</span><span class=\"token function\">setItem</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line>      <span class=\"token punctuation\">}</span>\n</span><span class=code-line>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> sessionStorage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line>\n</span><span class=code-line>    <span class=\"token function\">use</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n</span><span class=code-line><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></code></pre><p>The code above uses the context's <a href=https://playwright.dev/docs/api/class-browsercontext#browser-context-add-init-script><code>addInitScript function</code></a>, which can add a client-side script to the current page.<p>The script turns the file contents into a JSON object and updates the browser sessionStoage with the contents.<p>With this in place, we can run and pass tests without calling any additional code.<pre class=language-ts><code class=\"language-ts code-highlight\"><span class=code-line><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> expect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@playwright/test\"</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> test <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./sessionStorage\"</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line>\n</span><span class=code-line>test<span class=\"token punctuation\">.</span><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/parodos\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n</span><span class=code-line>  <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"should render projects page\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> page <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n</span><span class=code-line>    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">goto</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string template-punctuation\">`</span><span class=\"token string\">/</span><span class=\"token string template-punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line>\n</span><span class=code-line>    <span class=\"token keyword\">await</span> <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">.</span><span class=\"token function\">locator</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[href*=\"/parodos\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeVisible</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line>\n</span><span class=code-line>    page<span class=\"token punctuation\">.</span><span class=\"token function\">locator</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[href*=\"/parodos\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line>\n</span><span class=code-line>    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">waitForSelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"data-testid=header-title\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line>\n</span><span class=code-line>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">.</span><span class=\"token function\">url</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toContain</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string template-punctuation\">`</span><span class=\"token string\">/parodos</span><span class=\"token string template-punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line>\n</span><span class=code-line>    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"button\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"Add new project\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line>\n</span><span class=code-line>    <span class=\"token keyword\">await</span> page<span class=\"token punctuation\">.</span><span class=\"token function\">waitForSelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"data-testid=create-project\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=code-line><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></code></pre><p>The critical thing to note is that we are importing the extended test from the fixture file and not from Playright itself:<pre class=language-ts><code class=\"language-ts code-highlight\"><span class=code-line><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> test <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./sessionStorage\"</span><span class=\"token punctuation\">;</span>\n</span></code></pre><h2>Epilogue</h2><p>It is a pity that Playwright's <code>storageState</code> does not support sessionStorage but it is possible with the steps outlined above.",
  "frontmatter": {
    "meta": {
      "title": "Store authentication state across Playwright tests in applications that use sessionStorage",
      "description": "How to store authentication state across tests if your application stores tokens in sessionStorage.",
      "date": "2023-07-31T00:00:00.000Z",
      "image": "https://res.cloudinary.com/ddospxsc8/image/upload/v1690741574/playwright_iofvmm.png",
      "tags": ["playwright", "testing"]
    }
  }
}
