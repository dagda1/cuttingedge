{
  "html": "<p>Imagine a week before launching the online offering that you and your team have been burning the midnight oil over that you suddenly discover you have security exploits such as cross-site scripting attacks, man-in-the-middle attacks, cross-domain information leakage, cookie compromise, content delivery network compromise, or improperly issued certificates. Having this reported to you can knock your go-live date back months, or, even worse, your users could lose all confidence if the web offering is hacked through these exploits.</p>\n<p>One of my primary drivers is to lead a stress-free life. I am 53, and I cannot eat pizza any more after being offered it too many times as a scant reward for working ridiculous hours in my younger days. I don't work silly hours any more. I cover my back at all times and often when a project is just starting.</p>\n<p>Following on from my last post <a href=\"https://frontendrescue.com/posts/2023-09-04-5-things-to-automate\">5 Things that should be Automated in a TypeScript/Javascript Monorepo</a>, I am going to add a sixth.</p>\n<h2>Check your website is safe on every commit.</h2>\n<p>Mozzilla has a free offering called the <a href=\"https://observatory.mozilla.org/\">Mozilla HTTP Observatory</a> that comes with an <a href=\"https://github.com/mozilla/http-observatory/blob/master/httpobs/docs/api.md\">API</a> and <a href=\"https://github.com/mozilla/observatory-cli\">cli tools</a>.</p>\n<p>The Mozilla HTTP Observatory is a set of tools to analyze your website and inform you if you are utilizing the many available methods to secure it. Mozilla HTTP Observatory will give you a score out of a hundred, although it is possible to get more than a hundred out of a hundred.</p>\n<h2>Run Mozilla HTTP Observatory in a GitHub action</h2>\n<p>I have the following steps in a deploy GitHub action that use <a href=\"https://github.com/simonireilly/observatory-github-action/tree/v0.0.2-beta.0/\">this Github action</a> to run the tests against the <code>web_host</code> field specified below.</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Run</span> <span class=\"hljs-string\">Mozilla</span> <span class=\"hljs-string\">Observatory</span> <span class=\"hljs-string\">tests</span>\n  <span class=\"hljs-attr\">if:</span> <span class=\"hljs-string\">github.event_name</span> <span class=\"hljs-string\">==</span> <span class=\"hljs-string\">'pull_request'</span>\n  <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">simonireilly/observatory-github-action@v0.0.2-beta.0</span>\n  <span class=\"hljs-attr\">id:</span> <span class=\"hljs-string\">observatory</span>\n  <span class=\"hljs-attr\">with:</span>\n    <span class=\"hljs-attr\">web_host:</span> <span class=\"hljs-string\">https://staging.frontendrescue.com</span>\n\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Create</span> <span class=\"hljs-string\">commit</span> <span class=\"hljs-string\">comment</span>\n  <span class=\"hljs-attr\">if:</span> <span class=\"hljs-string\">github.event_name</span> <span class=\"hljs-string\">==</span> <span class=\"hljs-string\">'pull_request'</span>\n  <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">peter-evans/commit-comment@v1</span>\n  <span class=\"hljs-attr\">with:</span>\n    <span class=\"hljs-attr\">body:</span> <span class=\"hljs-string\">\"# Branch PR $<span class=\"hljs-template-variable\">{{ steps.observatory.outputs.observatory-report }}</span>\"</span>\n    <span class=\"hljs-attr\">GITHUB_TOKEN:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.GITHUB_TOKEN</span> <span class=\"hljs-string\">}}</span>\n</code></pre>\n<p>When I first added the steps below, I got the following terrible score of <strong>15/100</strong> on the staging version of the site you are looking at:</p>\n<p><img src=\"https://res.cloudinary.com/ddospxsc8/image/upload/v1694638552/observatory-before_gxmbqt.png\" alt=\"bad mozilla observatory score\">.</p>\n<h2>A little work yields incredible results</h2>\n<p>The site you are looking at is a <a href=\"https://remix.run/docs/en/main\">remix-run application</a> and I was able to add the following HTTP headers based on the observations returned from Mozilla observatory.</p>\n<pre><code class=\"hljs language-ts\"><span class=\"hljs-keyword\">const</span> contentSecurityPolicy = [\n  <span class=\"hljs-string\">`base-uri 'self' <span class=\"hljs-subst\">${CDN}</span>`</span>,\n  <span class=\"hljs-string\">`default-src 'none'`</span>,\n  <span class=\"hljs-string\">`script-src 'self' <span class=\"hljs-subst\">${CDN}</span> <span class=\"hljs-subst\">${TRACKING}</span> 'unsafe-inline' https://plausible.io https://www.google-analytics.com`</span>,\n  <span class=\"hljs-string\">`style-src 'self' <span class=\"hljs-subst\">${CDN}</span> https://fonts.googleapis.com https://fonts.googleapis.com 'unsafe-inline' data:`</span>,\n  <span class=\"hljs-string\">`img-src 'self' <span class=\"hljs-subst\">${CDN}</span> https://www.google-analytics.com https://assets.calendly.com data: blob:`</span>,\n  <span class=\"hljs-string\">`font-src 'self' https://fonts.googleapis.com https://fonts.gstatic.com`</span>,\n  <span class=\"hljs-string\">`frame-src 'self' https://plausible.io https://calendly.com`</span>,\n  <span class=\"hljs-string\">`media-src 'self' <span class=\"hljs-subst\">${CDN}</span> https://cdn.plyr.io`</span>,\n  <span class=\"hljs-string\">`connect-src 'self' <span class=\"hljs-subst\">${CRM}</span> <span class=\"hljs-subst\">${NEWSLETTER}</span> <span class=\"hljs-subst\">${CDN}</span> <span class=\"hljs-subst\">${TRACKING}</span> https://cdn.plyr.io https://plausible.io`</span>,\n  <span class=\"hljs-string\">`frame-ancestors 'self' https://plausible.io`</span>,\n  <span class=\"hljs-string\">`form-action 'self' <span class=\"hljs-subst\">${NEWSLETTER}</span> <span class=\"hljs-subst\">${CRM}</span> <span class=\"hljs-subst\">${CDN}</span>;`</span>,\n].<span class=\"hljs-title function_\">join</span>(<span class=\"hljs-string\">\";\"</span>);\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">const</span> <span class=\"hljs-attr\">headers</span>: <span class=\"hljs-title class_\">HeadersFunction</span> = <span class=\"hljs-function\">() =></span> {\n  <span class=\"hljs-keyword\">return</span> {\n    <span class=\"hljs-string\">\"X-XSS-Protection\"</span>: <span class=\"hljs-string\">\"1; mode=block\"</span>,\n    <span class=\"hljs-string\">\"X-Content-Type-Options\"</span>: <span class=\"hljs-string\">\"nosniff\"</span>,\n    <span class=\"hljs-string\">\"Referrer-Policy\"</span>: <span class=\"hljs-string\">\"strict-origin-when-cross-origin\"</span>,\n    <span class=\"hljs-string\">\"X-Frame-Options\"</span>: <span class=\"hljs-string\">\"DENY\"</span>,\n    <span class=\"hljs-string\">\"Strict-Transport-Security\"</span>: <span class=\"hljs-string\">\"max-age=63072000\"</span>,\n    <span class=\"hljs-string\">\"Content-Security-Policy\"</span>: contentSecurityPolicy,\n  };\n};\n</code></pre>\n<p>After I committed this change, the score has gone up to an unfathomable <strong>105/100</strong>.</p>\n<p><img src=\"https://res.cloudinary.com/ddospxsc8/image/upload/v1694638552/observatory_after_yhj0gh.png\" alt=\"better Mozilla Observatory score\">.</p>\n<h2>Running Observatory tests against a dynamic URL</h2>\n<p>I use Mozilla Observatory on another website that is hosted on <a href=\"https://vercel.com/\">Vercel</a>, which comes with an excellent <a href=\"https://vercel.com/docs/deployments/preview-deployments\">preview deployments feature</a> that creates a preview on every commit that is accessible by a dynamic URL. I have the following GitHub action that waits for the preview URL before running the tests:</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Mozilla</span> <span class=\"hljs-string\">Observatory</span> <span class=\"hljs-string\">Test</span>\n\n<span class=\"hljs-attr\">on:</span>\n  <span class=\"hljs-attr\">pull_request:</span>\n\n<span class=\"hljs-attr\">jobs:</span>\n  <span class=\"hljs-attr\">observatory:</span>\n    <span class=\"hljs-attr\">runs-on:</span> <span class=\"hljs-string\">ubuntu-latest</span>\n    <span class=\"hljs-attr\">steps:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Get</span> <span class=\"hljs-string\">Temporary</span> <span class=\"hljs-string\">Vercel</span> <span class=\"hljs-string\">Preview</span> <span class=\"hljs-string\">URL</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">patrickedqvist/wait-for-vercel-preview@v1.2.0</span>\n        <span class=\"hljs-attr\">id:</span> <span class=\"hljs-string\">vercel_preview_url</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">token:</span> <span class=\"hljs-string\">${{secrets.GITHUB_TOKEN}}</span>\n          <span class=\"hljs-attr\">max_timeout:</span> <span class=\"hljs-number\">600</span> <span class=\"hljs-comment\"># 10 minutes</span>\n          <span class=\"hljs-attr\">check_interval:</span> <span class=\"hljs-number\">10</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/setup-node@v1</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">node-version:</span> <span class=\"hljs-number\">18</span>\n          <span class=\"hljs-attr\">registry-url:</span> <span class=\"hljs-string\">\"https://registry.npmjs.org\"</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/checkout@v2</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">fetch-depth:</span> <span class=\"hljs-number\">0</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Test</span> <span class=\"hljs-string\">Observatory</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">simonireilly/observatory-github-action@v0.0.2-beta.0</span>\n        <span class=\"hljs-attr\">id:</span> <span class=\"hljs-string\">observatory</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">web_host:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">steps.vercel_preview_url.outputs.url</span> <span class=\"hljs-string\">}}</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Create</span> <span class=\"hljs-string\">commit</span> <span class=\"hljs-string\">comment</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">peter-evans/commit-comment@v1</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">body:</span> <span class=\"hljs-string\">\"# Branch PR $<span class=\"hljs-template-variable\">{{ steps.observatory.outputs.observatory-report }}</span>\"</span>\n          <span class=\"hljs-attr\">GITHUB_TOKEN:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.GITHUB_TOKEN</span> <span class=\"hljs-string\">}}</span>\n</code></pre>\n<h2>TLDR!</h2>\n<p>Mozilla observatory tests are not a comprehensive suite of tests and will not catch things such as SQL injection, but for the website you are currently reading, the observatory tests are adequate.</p>\n<p>If you want to put security concerns to bed, I would generally advocate using something like <a href=\"https://aws.amazon.com/waf/\">AWS WAF</a>, which does make your frontend incredibly secure and can take care of most of the <a href=\"https://owasp.org/www-project-top-ten/\">OWASP top 10 vulnerabilities</a> if not all.</p>\n<p>The main takeaway is that you should be ready for anything that comes your way. Do not have a frantic owner or client screaming blue murder because your website has been hacked. Be proactive, be vigilant.....behave!</p>",
  "frontmatter": {
    "meta": {
      "title": "Add this Github action to avoid security exploits",
      "description": "Find out now before you suddenly find out you have security exploits",
      "date": "2023-09-13T00:00:00.000Z",
      "image": "https://res.cloudinary.com/ddospxsc8/image/upload/v1694611874/observatory_umk7ra.png",
      "tags": ["github-actions", "continuous-integration", "devops"]
    }
  }
}
