{
  "html": "<p>Imagine a week before launching the online offering that you and your team have been burning the midnight oil over that you suddenly discover you have security exploits such as cross-site scripting attacks, man-in-the-middle attacks, cross-domain information leakage, cookie compromise, content delivery network compromise, or improperly issued certificates. Having this reported to you can knock your go-live date back months, or, even worse, your users could lose all confidence if the web offering is hacked through these exploits.<p>One of my primary drivers is to lead a stress-free life. I am 53, and I cannot eat pizza any more after being offered it too many times as a scant reward for working ridiculous hours in my younger days. I don't work silly hours any more. I cover my back at all times and often when a project is just starting.<p>Following on from my last post <a href=https://frontendrescue.com/posts/2023-09-04-5-things-to-automate>5 Things that should be Automated in a TypeScript/Javascript Monorepo</a>, I am going to add a sixth.<h2>Check your website is safe on every commit.</h2><p>Mozzilla has a free offering called the <a href=https://observatory.mozilla.org/>Mozilla HTTP Observatory</a> that comes with an <a href=https://github.com/mozilla/http-observatory/blob/master/httpobs/docs/api.md>API</a> and <a href=https://github.com/mozilla/observatory-cli>cli tools</a>.<p>The Mozilla HTTP Observatory is a set of tools to analyze your website and inform you if you are utilizing the many available methods to secure it. Mozilla HTTP Observatory will give you a score out of a hundred, although it is possible to get more than a hundred out of a hundred.<h2>Run Mozilla HTTP Observatory in a GitHub action</h2><p>I have the following steps in a deploy GitHub action that use <a href=https://github.com/simonireilly/observatory-github-action/tree/v0.0.2-beta.0/>this Github action</a> to run the tests against the <code>web_host</code> field specified below.<pre class=language-yml><code class=\"language-yml code-highlight\"><span class=\"code-line line-number\"line=1><span class=\"token punctuation\">-</span> <span class=\"token atrule key\">name</span><span class=\"token punctuation\">:</span> Run Mozilla Observatory tests\n</span><span class=\"code-line line-number\"line=2>  <span class=\"token atrule key\">if</span><span class=\"token punctuation\">:</span> github.event_name == 'pull_request'\n</span><span class=\"code-line line-number\"line=3>  <span class=\"token atrule key\">uses</span><span class=\"token punctuation\">:</span> simonireilly/observatory<span class=\"token punctuation\">-</span>github<span class=\"token punctuation\">-</span>action@v0.0.2<span class=\"token punctuation\">-</span>beta.0\n</span><span class=\"code-line line-number\"line=4>  <span class=\"token atrule key\">id</span><span class=\"token punctuation\">:</span> observatory\n</span><span class=\"code-line line-number\"line=5>  <span class=\"token atrule key\">with</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number highlight-line\"line=6>    <span class=\"token atrule key\">web_host</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">:</span>//staging.frontendrescue.com\n</span><span class=\"code-line line-number\"line=7>\n</span><span class=\"code-line line-number\"line=8><span class=\"token punctuation\">-</span> <span class=\"token atrule key\">name</span><span class=\"token punctuation\">:</span> Create commit comment\n</span><span class=\"code-line line-number\"line=9>  <span class=\"token atrule key\">if</span><span class=\"token punctuation\">:</span> github.event_name == 'pull_request'\n</span><span class=\"code-line line-number\"line=10>  <span class=\"token atrule key\">uses</span><span class=\"token punctuation\">:</span> peter<span class=\"token punctuation\">-</span>evans/commit<span class=\"token punctuation\">-</span>comment@v1\n</span><span class=\"code-line line-number\"line=11>  <span class=\"token atrule key\">with</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=12>    <span class=\"token atrule key\">body</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"# Branch PR ${{ steps.observatory.outputs.observatory-report }}\"</span>\n</span><span class=\"code-line line-number\"line=13>    <span class=\"token atrule key\">GITHUB_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GITHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n</span></code></pre><p>When I first added the steps below, I got the following terrible score of <strong>15/100</strong> on the staging version of the site you are looking at:<p><img alt=\"bad mozilla observatory score\"src=https://res.cloudinary.com/ddospxsc8/image/upload/v1694638552/observatory-before_gxmbqt.png>.<h2>A little work yields incredible results</h2><p>The site you are looking at is a <a href=https://remix.run/docs/en/main>remix-run application</a> and I was able to add the following HTTP headers based on the observations returned from Mozilla observatory.<pre class=language-ts><code class=\"code-highlight language-ts\"><span class=\"code-line line-number\"line=1><span class=\"token keyword\">const</span> contentSecurityPolicy <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n</span><span class=\"code-line line-number\"line=2>  <span class=\"token template-string\"><span class=\"token string template-punctuation\">`</span><span class=\"token string\">base-uri 'self' </span><span class=\"token interpolation\"><span class=\"token punctuation interpolation-punctuation\">${</span><span class=\"token constant\">CDN</span><span class=\"token punctuation interpolation-punctuation\">}</span></span><span class=\"token string template-punctuation\">`</span></span><span class=\"token punctuation\">,</span>\n</span><span class=\"code-line line-number\"line=3>  <span class=\"token template-string\"><span class=\"token string template-punctuation\">`</span><span class=\"token string\">default-src 'none'</span><span class=\"token string template-punctuation\">`</span></span><span class=\"token punctuation\">,</span>\n</span><span class=\"code-line line-number\"line=4>  <span class=\"token template-string\"><span class=\"token string template-punctuation\">`</span><span class=\"token string\">script-src 'self' </span><span class=\"token interpolation\"><span class=\"token punctuation interpolation-punctuation\">${</span><span class=\"token constant\">CDN</span><span class=\"token punctuation interpolation-punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token punctuation interpolation-punctuation\">${</span><span class=\"token constant\">TRACKING</span><span class=\"token punctuation interpolation-punctuation\">}</span></span><span class=\"token string\"> 'unsafe-inline' https://plausible.io https://www.google-analytics.com</span><span class=\"token string template-punctuation\">`</span></span><span class=\"token punctuation\">,</span>\n</span><span class=\"code-line line-number\"line=5>  <span class=\"token template-string\"><span class=\"token string template-punctuation\">`</span><span class=\"token string\">style-src 'self' </span><span class=\"token interpolation\"><span class=\"token punctuation interpolation-punctuation\">${</span><span class=\"token constant\">CDN</span><span class=\"token punctuation interpolation-punctuation\">}</span></span><span class=\"token string\"> https://fonts.googleapis.com https://fonts.googleapis.com 'unsafe-inline' data:</span><span class=\"token string template-punctuation\">`</span></span><span class=\"token punctuation\">,</span>\n</span><span class=\"code-line line-number\"line=6>  <span class=\"token template-string\"><span class=\"token string template-punctuation\">`</span><span class=\"token string\">img-src 'self' </span><span class=\"token interpolation\"><span class=\"token punctuation interpolation-punctuation\">${</span><span class=\"token constant\">CDN</span><span class=\"token punctuation interpolation-punctuation\">}</span></span><span class=\"token string\"> https://www.google-analytics.com https://assets.calendly.com data: blob:</span><span class=\"token string template-punctuation\">`</span></span><span class=\"token punctuation\">,</span>\n</span><span class=\"code-line line-number\"line=7>  <span class=\"token template-string\"><span class=\"token string template-punctuation\">`</span><span class=\"token string\">font-src 'self' https://fonts.googleapis.com https://fonts.gstatic.com</span><span class=\"token string template-punctuation\">`</span></span><span class=\"token punctuation\">,</span>\n</span><span class=\"code-line line-number\"line=8>  <span class=\"token template-string\"><span class=\"token string template-punctuation\">`</span><span class=\"token string\">frame-src 'self' https://plausible.io https://calendly.com</span><span class=\"token string template-punctuation\">`</span></span><span class=\"token punctuation\">,</span>\n</span><span class=\"code-line line-number\"line=9>  <span class=\"token template-string\"><span class=\"token string template-punctuation\">`</span><span class=\"token string\">media-src 'self' </span><span class=\"token interpolation\"><span class=\"token punctuation interpolation-punctuation\">${</span><span class=\"token constant\">CDN</span><span class=\"token punctuation interpolation-punctuation\">}</span></span><span class=\"token string\"> https://cdn.plyr.io</span><span class=\"token string template-punctuation\">`</span></span><span class=\"token punctuation\">,</span>\n</span><span class=\"code-line line-number\"line=10>  <span class=\"token template-string\"><span class=\"token string template-punctuation\">`</span><span class=\"token string\">connect-src 'self' </span><span class=\"token interpolation\"><span class=\"token punctuation interpolation-punctuation\">${</span><span class=\"token constant\">CRM</span><span class=\"token punctuation interpolation-punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token punctuation interpolation-punctuation\">${</span><span class=\"token constant\">NEWSLETTER</span><span class=\"token punctuation interpolation-punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token punctuation interpolation-punctuation\">${</span><span class=\"token constant\">CDN</span><span class=\"token punctuation interpolation-punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token punctuation interpolation-punctuation\">${</span><span class=\"token constant\">TRACKING</span><span class=\"token punctuation interpolation-punctuation\">}</span></span><span class=\"token string\"> https://cdn.plyr.io https://plausible.io</span><span class=\"token string template-punctuation\">`</span></span><span class=\"token punctuation\">,</span>\n</span><span class=\"code-line line-number\"line=11>  <span class=\"token template-string\"><span class=\"token string template-punctuation\">`</span><span class=\"token string\">frame-ancestors 'self' https://plausible.io</span><span class=\"token string template-punctuation\">`</span></span><span class=\"token punctuation\">,</span>\n</span><span class=\"code-line line-number\"line=12>  <span class=\"token template-string\"><span class=\"token string template-punctuation\">`</span><span class=\"token string\">form-action 'self' </span><span class=\"token interpolation\"><span class=\"token punctuation interpolation-punctuation\">${</span><span class=\"token constant\">NEWSLETTER</span><span class=\"token punctuation interpolation-punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token punctuation interpolation-punctuation\">${</span><span class=\"token constant\">CRM</span><span class=\"token punctuation interpolation-punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token punctuation interpolation-punctuation\">${</span><span class=\"token constant\">CDN</span><span class=\"token punctuation interpolation-punctuation\">}</span></span><span class=\"token string\">;</span><span class=\"token string template-punctuation\">`</span></span><span class=\"token punctuation\">,</span>\n</span><span class=\"code-line line-number\"line=13><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\";\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line line-number\"line=14>\n</span><span class=\"code-line line-number\"line=15><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> headers<span class=\"token operator\">:</span> <span class=\"token function function-variable\">HeadersFunction</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n</span><span class=\"code-line line-number\"line=16>  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n</span><span class=\"code-line line-number\"line=17>    <span class=\"token property string-property\">\"X-XSS-Protection\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1; mode=block\"</span><span class=\"token punctuation\">,</span>\n</span><span class=\"code-line line-number\"line=18>    <span class=\"token property string-property\">\"X-Content-Type-Options\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"nosniff\"</span><span class=\"token punctuation\">,</span>\n</span><span class=\"code-line line-number\"line=19>    <span class=\"token property string-property\">\"Referrer-Policy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"strict-origin-when-cross-origin\"</span><span class=\"token punctuation\">,</span>\n</span><span class=\"code-line line-number\"line=20>    <span class=\"token property string-property\">\"X-Frame-Options\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"DENY\"</span><span class=\"token punctuation\">,</span>\n</span><span class=\"code-line line-number\"line=21>    <span class=\"token property string-property\">\"Strict-Transport-Security\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"max-age=63072000\"</span><span class=\"token punctuation\">,</span>\n</span><span class=\"code-line line-number\"line=22>    <span class=\"token property string-property\">\"Content-Security-Policy\"</span><span class=\"token operator\">:</span> contentSecurityPolicy<span class=\"token punctuation\">,</span>\n</span><span class=\"code-line line-number\"line=23>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line line-number\"line=24><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</span></code></pre><p>After I committed this change, the score has gone up to an unfathomable <strong>105/100</strong>.<p><img alt=\"better Mozilla Observatory score\"src=https://res.cloudinary.com/ddospxsc8/image/upload/v1694638552/observatory_after_yhj0gh.png>.<h2>Running Observatory tests against a dynamic URL</h2><p>I use Mozilla Observatory on another website that is hosted on <a href=https://vercel.com/>Vercel</a>, which comes with an excellent <a href=https://vercel.com/docs/deployments/preview-deployments>preview deployments feature</a> that creates a preview on every commit that is accessible by a dynamic URL. I have the following GitHub action that waits for the preview URL before running the tests:<pre class=language-yml><code class=\"language-yml code-highlight\"><span class=\"code-line line-number\"line=1><span class=\"token atrule key\">name</span><span class=\"token punctuation\">:</span> Mozilla Observatory Test\n</span><span class=\"code-line line-number\"line=2>\n</span><span class=\"code-line line-number\"line=3><span class=\"token atrule key\">on</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=4>  <span class=\"token atrule key\">pull_request</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=5>\n</span><span class=\"code-line line-number\"line=6><span class=\"token atrule key\">jobs</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=7>  <span class=\"token atrule key\">observatory</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=8>    <span class=\"token atrule key\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n</span><span class=\"code-line line-number\"line=9>    <span class=\"token atrule key\">steps</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=10>      <span class=\"token punctuation\">-</span> <span class=\"token atrule key\">name</span><span class=\"token punctuation\">:</span> Get Temporary Vercel Preview URL\n</span><span class=\"code-line line-number highlight-line\"line=11>        <span class=\"token atrule key\">uses</span><span class=\"token punctuation\">:</span> patrickedqvist/wait<span class=\"token punctuation\">-</span>for<span class=\"token punctuation\">-</span>vercel<span class=\"token punctuation\">-</span>preview@v1.2.0\n</span><span class=\"code-line line-number\"line=12>        <span class=\"token atrule key\">id</span><span class=\"token punctuation\">:</span> vercel_preview_url\n</span><span class=\"code-line line-number\"line=13>        <span class=\"token atrule key\">with</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=14>          <span class=\"token atrule key\">token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>secrets.GITHUB_TOKEN<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n</span><span class=\"code-line line-number\"line=15>          <span class=\"token atrule key\">max_timeout</span><span class=\"token punctuation\">:</span> <span class=\"token number\">600</span> <span class=\"token comment\"># 10 minutes</span>\n</span><span class=\"code-line line-number\"line=16>          <span class=\"token atrule key\">check_interval</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span>\n</span><span class=\"code-line line-number\"line=17>\n</span><span class=\"code-line line-number\"line=18>      <span class=\"token punctuation\">-</span> <span class=\"token atrule key\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v1\n</span><span class=\"code-line line-number\"line=19>        <span class=\"token atrule key\">with</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=20>          <span class=\"token atrule key\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">18</span>\n</span><span class=\"code-line line-number\"line=21>          <span class=\"token atrule key\">registry-url</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"https://registry.npmjs.org\"</span>\n</span><span class=\"code-line line-number\"line=22>\n</span><span class=\"code-line line-number\"line=23>      <span class=\"token punctuation\">-</span> <span class=\"token atrule key\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n</span><span class=\"code-line line-number\"line=24>        <span class=\"token atrule key\">with</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=25>          <span class=\"token atrule key\">fetch-depth</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n</span><span class=\"code-line line-number\"line=26>\n</span><span class=\"code-line line-number\"line=27>      <span class=\"token punctuation\">-</span> <span class=\"token atrule key\">name</span><span class=\"token punctuation\">:</span> Test Observatory\n</span><span class=\"code-line line-number\"line=28>        <span class=\"token atrule key\">uses</span><span class=\"token punctuation\">:</span> simonireilly/observatory<span class=\"token punctuation\">-</span>github<span class=\"token punctuation\">-</span>action@v0.0.2<span class=\"token punctuation\">-</span>beta.0\n</span><span class=\"code-line line-number\"line=29>        <span class=\"token atrule key\">id</span><span class=\"token punctuation\">:</span> observatory\n</span><span class=\"code-line line-number\"line=30>        <span class=\"token atrule key\">with</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number highlight-line\"line=31>          <span class=\"token atrule key\">web_host</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> steps.vercel_preview_url.outputs.url <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n</span><span class=\"code-line line-number\"line=32>\n</span><span class=\"code-line line-number\"line=33>      <span class=\"token punctuation\">-</span> <span class=\"token atrule key\">name</span><span class=\"token punctuation\">:</span> Create commit comment\n</span><span class=\"code-line line-number\"line=34>        <span class=\"token atrule key\">uses</span><span class=\"token punctuation\">:</span> peter<span class=\"token punctuation\">-</span>evans/commit<span class=\"token punctuation\">-</span>comment@v1\n</span><span class=\"code-line line-number\"line=35>        <span class=\"token atrule key\">with</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=36>          <span class=\"token atrule key\">body</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"# Branch PR ${{ steps.observatory.outputs.observatory-report }}\"</span>\n</span><span class=\"code-line line-number\"line=37>          <span class=\"token atrule key\">GITHUB_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GITHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n</span></code></pre><h2>TLDR!</h2><p>Mozilla observatory tests are not a comprehensive suite of tests and will not catch things such as SQL injection, but for the website you are currently reading, the observatory tests are adequate.<p>If you want to put security concerns to bed, I would generally advocate using something like <a href=https://aws.amazon.com/waf/>AWS WAF</a>, which does make your frontend incredibly secure and can take care of most of the <a href=https://owasp.org/www-project-top-ten/>OWASP top 10 vulnerabilities</a> if not all.<p>The main takeaway is that you should be ready for anything that comes your way. Do not have a frantic owner or client screaming blue murder because your website has been hacked. Be proactive, be vigilant.....behave!",
  "frontmatter": {
    "meta": {
      "title": "Add this Github action to avoid security exploits",
      "description": "Find out now before you suddenly find out you have security exploits",
      "date": "2023-09-13T00:00:00.000Z",
      "image": "https://res.cloudinary.com/ddospxsc8/image/upload/v1694611874/observatory_umk7ra.png",
      "tags": ["github-actions", "continuous-integration", "devops"]
    }
  }
}
