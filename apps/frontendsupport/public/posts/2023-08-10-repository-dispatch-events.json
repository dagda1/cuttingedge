{
  "html": "<p>It is easy to run one Github action job after another by using the <a href=https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idneeds>needs</a> keyword.<pre class=language-yml><code class=\"language-yml code-highlight\"><span class=\"code-line line-number\"line=1><span class=\"token atrule key\">on</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=2>  <span class=\"token atrule key\">push</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=3>    <span class=\"token atrule key\">branches</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=4>      <span class=\"token punctuation\">-</span> main\n</span><span class=\"code-line line-number\"line=5>\n</span><span class=\"code-line line-number\"line=6><span class=\"token atrule key\">jobs</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=7>  <span class=\"token atrule key\">build</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=8>    <span class=\"token atrule key\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n</span><span class=\"code-line line-number\"line=9>    <span class=\"token atrule key\">steps</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=10>      <span class=\"token punctuation\">-</span> <span class=\"token atrule key\">name</span><span class=\"token punctuation\">:</span> Run build\n</span><span class=\"code-line line-number\"line=11>        <span class=\"token atrule key\">run</span><span class=\"token punctuation\">:</span> echo \"Running build steps<span class=\"token punctuation\">...</span>\"\n</span><span class=\"code-line line-number\"line=12>\n</span><span class=\"code-line line-number\"line=13>  <span class=\"token atrule key\">deploy</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number highlight-line\"line=14>    <span class=\"token atrule key\">needs</span><span class=\"token punctuation\">:</span> build\n</span><span class=\"code-line line-number\"line=15>    <span class=\"token atrule key\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n</span><span class=\"code-line line-number\"line=16>    <span class=\"token atrule key\">steps</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=17>      <span class=\"token punctuation\">-</span> <span class=\"token atrule key\">name</span><span class=\"token punctuation\">:</span> Checkout code\n</span><span class=\"code-line line-number\"line=18>        <span class=\"token atrule key\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n</span><span class=\"code-line line-number\"line=19>\n</span><span class=\"code-line line-number\"line=20>      <span class=\"token punctuation\">-</span> <span class=\"token atrule key\">name</span><span class=\"token punctuation\">:</span> Deploy code\n</span><span class=\"code-line line-number\"line=21>        <span class=\"token atrule key\">run</span><span class=\"token punctuation\">:</span> echo \"Deploying<span class=\"token punctuation\">...</span>\"\n</span></code></pre><p>In the example above, the <code>deploy</code> job has a <code>needs</code> directive that states that <code>deploy</code> can only run after <code>build</code> has been completed successfully.<p>However, what about if we want an entire series of jobs in a separate GitHub action file to run after a job in a completely different file has run?<h2>Repository Dispatch Events</h2><p>Fortunately, it is possible to create a <a href=\"https://docs.github.com/en/free-pro-team@latest/rest/repos/repos?apiVersion=2022-11-28#create-a-repository-dispatch-event\">repository dispatch event</a> to trigger Github actions.<p>A repository dispatch event is an endpoint that triggers a webhook event called <code>repository_dispatch</code>.<p>Even more, fortunately, is that somebody has wrapped the finer details of triggering a <code>repository_dispatch</code> webhook event into an excellent GitHub action in this <a href=https://github.com/peter-evans/repository-dispatch/tree/v1/>repo</a>.<p>I faced a problem running <a href=https://www.webpagetest.org/>webpage-test</a> on a staging site only after it was successfully deployed, and I wanted the logic segregated into its own Github action file.<p>Below is the code that creates the dispatch event for an event I have named <code>trigger-webpage-test-for-frontendsupport</code><div class=remark-code-title>build-and-deploy.yml</div><pre class=language-yml><code class=\"language-yml code-highlight\"><span class=\"code-line line-number\"line=1><span class=\"token punctuation\">-</span> <span class=\"token atrule key\">name</span><span class=\"token punctuation\">:</span> Trigger webpage test\n</span><span class=\"code-line line-number\"line=2>  <span class=\"token atrule key\">uses</span><span class=\"token punctuation\">:</span> peter<span class=\"token punctuation\">-</span>evans/repository<span class=\"token punctuation\">-</span>dispatch@v1\n</span><span class=\"code-line line-number\"line=3>  <span class=\"token atrule key\">with</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=4>    <span class=\"token atrule key\">token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.PAT <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n</span><span class=\"code-line line-number\"line=5>    <span class=\"token atrule key\">repository</span><span class=\"token punctuation\">:</span> dagda1/cuttingedge\n</span><span class=\"code-line line-number highlight-line\"line=6>    <span class=\"token atrule key\">event-type</span><span class=\"token punctuation\">:</span> trigger<span class=\"token punctuation\">-</span>webpage<span class=\"token punctuation\">-</span>test<span class=\"token punctuation\">-</span>for<span class=\"token punctuation\">-</span>frontendsupport\n</span></code></pre><p>The action that runs web-page-test in a different file:<div class=remark-code-title>webpage.test.yml</div><pre class=language-yml><code class=\"language-yml code-highlight\"><span class=\"code-line line-number\"line=1><span class=\"token atrule key\">name</span><span class=\"token punctuation\">:</span> run webpage test for frontendrescue\n</span><span class=\"code-line line-number\"line=2>\n</span><span class=\"code-line line-number highlight-line\"line=3><span class=\"token atrule key\">on</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number highlight-line\"line=4>  <span class=\"token atrule key\">repository_dispatch</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number highlight-line\"line=5>    <span class=\"token atrule key\">types</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>trigger<span class=\"token punctuation\">-</span>webpage<span class=\"token punctuation\">-</span>test<span class=\"token punctuation\">-</span>for<span class=\"token punctuation\">-</span>frontendsupport<span class=\"token punctuation\">]</span>\n</span><span class=\"code-line line-number\"line=6>\n</span><span class=\"code-line line-number\"line=7><span class=\"token atrule key\">jobs</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=8>  <span class=\"token atrule key\">deploy</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=9>    <span class=\"token atrule key\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n</span><span class=\"code-line line-number\"line=10>    <span class=\"token atrule key\">steps</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=11>      <span class=\"token punctuation\">-</span> <span class=\"token atrule key\">name</span><span class=\"token punctuation\">:</span> Checkout code\n</span><span class=\"code-line line-number\"line=12>        <span class=\"token atrule key\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n</span><span class=\"code-line line-number\"line=13>\n</span><span class=\"code-line line-number\"line=14>      <span class=\"token punctuation\">-</span> <span class=\"token atrule key\">name</span><span class=\"token punctuation\">:</span> WebPageTest Staging\n</span><span class=\"code-line line-number\"line=15>        <span class=\"token atrule key\">uses</span><span class=\"token punctuation\">:</span> WPO<span class=\"token punctuation\">-</span>Foundation/webpagetest<span class=\"token punctuation\">-</span>github<span class=\"token punctuation\">-</span>action@main\n</span><span class=\"code-line line-number\"line=16>        <span class=\"token atrule key\">with</span><span class=\"token punctuation\">:</span>\n</span><span class=\"code-line line-number\"line=17>          <span class=\"token atrule key\">apiKey</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.WPT_API_KEY <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n</span><span class=\"code-line line-number\"line=18>          <span class=\"token atrule key\">urls</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token string scalar\">\n</span></span><span class=\"code-line line-number\"line=19><span class=\"token string scalar\">            https://staging.frontendrescue.com/\n</span></span><span class=\"code-line line-number\"line=20><span class=\"token string scalar\">            https://staging.frontendrescue.com/posts/2023-07-28-session-storage-playwright</span>\n</span><span class=\"code-line line-number\"line=21>          <span class=\"token atrule key\">label</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'GitHub Action Test'</span>\n</span><span class=\"code-line line-number\"line=22>          <span class=\"token atrule key\">GITHUB_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GITHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n</span></code></pre><h2>GOTCHA ALERT!!!!</h2><p>One catch is that repository dispatch events will only trigger an event if the workflow is committed to the default branch (usually master/main etc.).<p>I initially wondered why the event was not triggered when committing to a feature branch, but once the action was in the <code>main</code> branch, the event got triggered.<h2>Wrapping up</h2><p>Repository dispatch events are an excellent way to generalise logic without resorting to the dreaded horrors of copying and pasting.",
  "frontmatter": {
    "meta": {
      "title": "How to trigger a GitHub action from a different GitHub action file",
      "description": "trigger a github action from a different file by using repository dispatch events",
      "date": "2023-08-10T00:00:00.000Z",
      "image": "https://res.cloudinary.com/ddospxsc8/image/upload/v1691673246/github_wt7a34.png",
      "tags": ["github-actions", "continuous-integration", "devops"]
    }
  }
}
