{
  "html": "<p>Managing a TypeScript monorepo can be a complex task with various moving parts. Automation ensures that everything runs smoothly, from dependency management to deployment. Automate these five things in a TypeScript or JavaScript monorepo to enhance productivity and maintainability.</p>\n<h2>1. Renovate for package.json Updates</h2>\n<h3>Why Automate This?</h3>\n<p>I've included this first because managing dependencies is a huge pain point in monorepos. Leaving the updating of each <code>package.json</code> file to a developer or, even worse, developers often leads to failures, especially when multiple packages are within the monorepo.</p>\n<h3>How to Automate</h3>\n<p>Use <a href=\"https://github.com/renovatebot/renovate\">renovate</a> to scan the monorepo repository automatically and generate Pull Requests to update dependencies. I like to confine my PRs to the weekend to keep the noise down, but this is all configurable through the extensive config options.</p>\n<p>Below is a view of some PRs created by the excellent <a href=\"https://github.com/renovatebot/renovate\">renovate</a>.</p>\n<p><img src=\"https://res.cloudinary.com/ddospxsc8/image/upload/v1693757509/renovate_pozccg.png\" alt=\"renovate pull requests\">.</p>\n<p>Each PR includes scores for confidence and adoptions for the dependency as well as the release notes from the PR for the dependency that is updated:</p>\n<p><img src=\"https://res.cloudinary.com/ddospxsc8/image/upload/v1693758376/renovate2_gzi3v1.png\" alt=\"renovate PR with confidence score and release notes\">.</p>\n<p>With <a href=\"https://github.com/renovatebot/renovate\">renovate</a>, it is possible to specify scheduling, grouping, and even auto-merge rules.</p>\n<p>Below is an example <code>renovate.json</code> for a monorepo that I control:</p>\n<pre><code class=\"hljs language-json\"><span class=\"hljs-punctuation\">{</span>\n  <span class=\"hljs-attr\">\"extends\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">\"config:base\"</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">\"group:monorepos\"</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"baseBranches\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">\"main\"</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"semanticCommitScope\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"deps\"</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"rangeStrategy\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"bump\"</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"rebaseLabel\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"rebase\"</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"rebaseWhen\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"auto\"</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"requiredStatusChecks\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"timezone\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"Europe/Dublin\"</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"schedule\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">\"before 8am every weekend\"</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"lockFileMaintenance\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">\"enabled\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">false</span></span>\n  <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"packageRules\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n    <span class=\"hljs-punctuation\">{</span>\n      <span class=\"hljs-attr\">\"packageNames\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">\"node\"</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">\"pnpm\"</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">\"enabled\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">false</span></span>\n    <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-punctuation\">{</span>\n      <span class=\"hljs-attr\">\"depTypeList\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">\"peerDependencies\"</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">\"enabled\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">false</span></span>\n    <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-punctuation\">{</span>\n      <span class=\"hljs-attr\">\"updateTypes\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">\"major\"</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">\"minor\"</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">\"patch\"</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">\"pin\"</span><span class=\"hljs-punctuation\">,</span> <span class=\"hljs-string\">\"digest\"</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">\"automerge\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">true</span></span>\n    <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-punctuation\">{</span>\n      <span class=\"hljs-attr\">\"depTypeList\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">\"devDependencies\"</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">\"automerge\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-literal\"><span class=\"hljs-keyword\">true</span></span>\n    <span class=\"hljs-punctuation\">}</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-punctuation\">{</span>\n      <span class=\"hljs-attr\">\"packagePatterns\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">\"eslint\"</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">\"groupName\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"eslint\"</span>\n    <span class=\"hljs-punctuation\">}</span>\n  <span class=\"hljs-punctuation\">]</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>\n<h3>Benefits</h3>\n<ul>\n<li>Keeps dependencies up-to-date, reducing security vulnerabilities.</li>\n<li>Frees developers from the manual task of updating each package.json.</li>\n</ul>\n<h2>2. <a href=\"https://github.com/changesets/changesets\">Adobe changesets</a> for Versioning and Changelog</h2>\n<p><img src=\"https://res.cloudinary.com/ddospxsc8/image/upload/v1693758875/changesets_oqpref.png\" alt=\"adobe changesets\"></p>\n<h3>Why Automate This?</h3>\n<p>In a monorepo, tracking changes across multiple packages can get chaotic. Leaving this to the diligence of the developer will always lead to problems. A versioning system helps maintain order. A naive approach is to use git commit messages to update the <code>CHANGELOG.md</code>. Dated git commit messages will lead to a suboptimal <code>CHANGELOG</code>.</p>\n<h3>How to Automate</h3>\n<p><a href=\"https://github.com/changesets/changesets\">Adobe changesets</a> offers a way to automate versioning and changelog updates. It provides commands to create changesets that describe the changes in your code.</p>\n<p>An interactive CLI will prompt the user for inputs to create the changeset and provide a proper message for the <code>CHANGELOG</code>:</p>\n<p><img src=\"https://res.cloudinary.com/ddospxsc8/image/upload/v1693807287/changesets2_eyatop.png\" alt=\"CLI\"></p>\n<p>The following two links provide complete information on how to get started with changesets:</p>\n<ul>\n<li><a href=\"https://github.com/changesets/changesets/blob/main/docs/intro-to-using-changesets.md\">using changesets</a></li>\n<li><a href=\"https://github.com/changesets/changesets/blob/main/packages/cli/README.md\">changesets CLI</a></li>\n</ul>\n<h3>Benefits</h3>\n<ul>\n<li>Streamlined versioning across multiple packages.</li>\n<li>Automatic generation of a detailed changelog.\n<img src=\"https://res.cloudinary.com/ddospxsc8/image/upload/v1693761122/changelog_zearai.png\" alt=\"changelog\"></li>\n</ul>\n<h2>3. Automate performance metrics</h2>\n<h3>Why Automate This?</h3>\n<p>Staying on top of performance metrics is critical. Do not wait until your users start complaining. You should know exactly where you stand on every commit.</p>\n<h3>How to Automate</h3>\n<p>I use <a href=\"https://www.webpagetest.org/\">WebpageTest</a>, which offers detailed performance metrics and allows tests from multiple geographical locations, simulating various browsers and network conditions. WebpageTest enables developers to identify bottlenecks, optimize for different user scenarios, and improve overall user experience.</p>\n<p>I have the following step in a GitHub action that supplies an array of URLs for WebpageTest to test.</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Trigger</span> <span class=\"hljs-string\">webpage</span> <span class=\"hljs-string\">test</span>\n  <span class=\"hljs-attr\">if:</span> <span class=\"hljs-string\">github.event_name</span> <span class=\"hljs-string\">==</span> <span class=\"hljs-string\">'pull_request'</span>\n  <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">peter-evans/repository-dispatch@v1</span>\n  <span class=\"hljs-attr\">with:</span>\n    <span class=\"hljs-attr\">token:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.GITHUB_TOKEN</span> <span class=\"hljs-string\">}}</span>\n    <span class=\"hljs-attr\">repository:</span> <span class=\"hljs-string\">dagda1/cuttingedge</span>\n    <span class=\"hljs-attr\">event-type:</span> <span class=\"hljs-string\">trigger-webpage-test-for-frontendsupport</span>\n</code></pre>\n<p>WebpageTest will automatically send an email and add a comment on the pull request for every commit to a pull request with detailed metrics:\n<img src=\"https://res.cloudinary.com/ddospxsc8/image/upload/v1693762721/webpagetest_krq5ku.png\" alt=\"webpage test pull request comment\"></p>\n<h3>Benefits</h3>\n<ul>\n<li>Know the moment performance starts going south</li>\n<li>Communicate performance metrics to all stakeholders</li>\n</ul>\n<h2>4. TurboRepo for Build and Test Acceleration</h2>\n<p><img src=\"https://res.cloudinary.com/ddospxsc8/image/upload/v1693760354/turborepo_w1wh1z.png\" alt=\"turborepo\"></p>\n<h3>Why Automate This?</h3>\n<p>Building and testing in a monorepo can be slow, especially as the codebase grows.</p>\n<h3>How to Automate</h3>\n<p><a href=\"https://turbo.build/\">Turborepo</a> accelerates this process by only building and testing the parts of your monorepo affected by individual commits.</p>\n<h3>Benefits</h3>\n<ul>\n<li>Faster build and test cycles.</li>\n<li>Resource optimization, as only relevant tasks are executed.</li>\n</ul>\n<h2>5. Automated Deployment</h2>\n<h3>Why Automate This?</h3>\n<p>It seems ridiculous to think manual deployments still happen. However, I have included automated deployments just in case anyone is still practising the dark art of throwing the dice and hoping for a six each time. Manual deployments are error-prone and can be a bottleneck in the development process.</p>\n<h3>How to Automate</h3>\n<p>Use CI/CD pipelines with tools like GitHub Actions or GitLab CI/CD to automate the deployment process.</p>\n<p>The website that you are currently reading uses the GitHub action below to deploy a <a href=\"https://remix.run/\">remix-run</a> application that deploys an <a href=\"https://arc.codes/docs/en/get-started/quickstart\">AWS architect</a> application to both <code>production</code> and <code>staging</code> variants depending on the context that the action is run in.</p>\n<pre><code class=\"hljs language-yml\"><span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Build</span> <span class=\"hljs-string\">and</span> <span class=\"hljs-string\">deploy</span>\n\n<span class=\"hljs-attr\">on:</span> [<span class=\"hljs-string\">push</span>, <span class=\"hljs-string\">pull_request</span>]\n\n<span class=\"hljs-attr\">env:</span>\n  <span class=\"hljs-attr\">CI:</span> <span class=\"hljs-literal\">true</span>\n  <span class=\"hljs-attr\">AWS_ACCESS_KEY_ID:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.AWS_ACCESS_KEY_ID</span> <span class=\"hljs-string\">}}</span>\n  <span class=\"hljs-attr\">AWS_SECRET_ACCESS_KEY:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.AWS_SECRET_ACCESS_KEY</span> <span class=\"hljs-string\">}}</span>\n  <span class=\"hljs-attr\">AWS_DEFAULT_REGION:</span> <span class=\"hljs-string\">\"us-east-1\"</span>\n\n<span class=\"hljs-attr\">jobs:</span>\n  <span class=\"hljs-attr\">deploy:</span>\n    <span class=\"hljs-attr\">environment:</span> <span class=\"hljs-string\">CI</span>\n    <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">build</span> <span class=\"hljs-string\">and</span> <span class=\"hljs-string\">deploy</span> <span class=\"hljs-string\">to</span> <span class=\"hljs-string\">AWS</span>\n    <span class=\"hljs-attr\">runs-on:</span> <span class=\"hljs-string\">ubuntu-latest</span>\n    <span class=\"hljs-attr\">steps:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">pnpm/action-setup@v2.4.0</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">version:</span> <span class=\"hljs-number\">8.7</span><span class=\"hljs-number\">.4</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Checkout</span> <span class=\"hljs-string\">Repo</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/checkout@v3</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Setup</span> <span class=\"hljs-string\">Node.js</span> <span class=\"hljs-number\">22.</span><span class=\"hljs-string\">x</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/setup-node@v3</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">node-version:</span> <span class=\"hljs-number\">22.</span><span class=\"hljs-string\">x</span>\n          <span class=\"hljs-attr\">cache:</span> <span class=\"hljs-string\">\"pnpm\"</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Cache</span> <span class=\"hljs-string\">pnpm</span> <span class=\"hljs-string\">modules</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/cache@v3</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">~/.pnpm-store</span>\n          <span class=\"hljs-attr\">key:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">runner.os</span> <span class=\"hljs-string\">}}-${{</span> <span class=\"hljs-string\">hashFiles('**/pnpm-lock.yaml')</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">restore-keys:</span> <span class=\"hljs-string\">|\n            ${{ runner.os }}-\n</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Install</span> <span class=\"hljs-string\">Dependencies</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">pnpm</span> <span class=\"hljs-string\">i</span>  <span class=\"hljs-string\">--no-frozen-lockfile</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Build</span> <span class=\"hljs-string\">App</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">pnpm</span> <span class=\"hljs-string\">build</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">architect</span> <span class=\"hljs-string\">deploy</span>\n        <span class=\"hljs-attr\">if:</span> <span class=\"hljs-string\">github.ref</span> <span class=\"hljs-string\">==</span> <span class=\"hljs-string\">'refs/heads/main'</span> <span class=\"hljs-string\">||</span> <span class=\"hljs-string\">startsWith(github.ref,</span> <span class=\"hljs-string\">'refs/tags/v'</span><span class=\"hljs-string\">)</span> <span class=\"hljs-string\">||</span> <span class=\"hljs-string\">github.event_name</span> <span class=\"hljs-string\">==</span> <span class=\"hljs-string\">'pull_request'</span>\n        <span class=\"hljs-attr\">working-directory:</span> <span class=\"hljs-string\">apps/frontendsupport</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          FLAGS=\"\"\n          if [[ \"${{ startsWith(github.ref, 'refs/tags/v') }}\" == true ]]; then\n            FLAGS=\"--production\"\n          else\n            FLAGS=\"--staging\"\n          fi\n</span>\n          <span class=\"hljs-string\">GIT_COMMIT=\"$(git</span> <span class=\"hljs-string\">rev-parse</span> <span class=\"hljs-string\">HEAD)\"</span> <span class=\"hljs-string\">pnpm</span> <span class=\"hljs-string\">arc</span> <span class=\"hljs-string\">deploy</span> <span class=\"hljs-string\">$FLAGS</span> <span class=\"hljs-string\">-v</span> <span class=\"hljs-string\">--prune</span>\n        <span class=\"hljs-attr\">env:</span>\n          <span class=\"hljs-attr\">NODE_ENV:</span> <span class=\"hljs-string\">production</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Invalidate</span> <span class=\"hljs-string\">Cloudfront</span> <span class=\"hljs-string\">cache</span> <span class=\"hljs-string\">staging</span>\n        <span class=\"hljs-attr\">if:</span> <span class=\"hljs-string\">github.ref</span> <span class=\"hljs-string\">==</span> <span class=\"hljs-string\">'refs/heads/main'</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">imehedi/actions-awscli-v2@latest</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">args:</span> <span class=\"hljs-string\">cloudfront</span> <span class=\"hljs-string\">create-invalidation</span> <span class=\"hljs-string\">--distribution-id</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.CLOUDFRONT_STAGING_ID</span> <span class=\"hljs-string\">}}</span> <span class=\"hljs-string\">--paths</span> <span class=\"hljs-string\">\"/*\"</span> <span class=\"hljs-string\">--no-cli-pager</span>\n\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Invalidate</span> <span class=\"hljs-string\">Cloudfront</span> <span class=\"hljs-string\">cache</span> <span class=\"hljs-string\">Production</span>\n        <span class=\"hljs-attr\">if:</span> <span class=\"hljs-string\">startsWith(github.ref,</span> <span class=\"hljs-string\">'refs/tags/v'</span><span class=\"hljs-string\">)</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">imehedi/actions-awscli-v2@latest</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">args:</span> <span class=\"hljs-string\">cloudfront</span> <span class=\"hljs-string\">create-invalidation</span> <span class=\"hljs-string\">--distribution-id</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.CLOUDFRONT_PRODUCTION_ID</span> <span class=\"hljs-string\">}}</span> <span class=\"hljs-string\">--paths</span> <span class=\"hljs-string\">\"/*\"</span> <span class=\"hljs-string\">--no-cli-pager</span>\n</code></pre>\n<h3>Benefits</h3>\n<ul>\n<li>Consistent and reliable deployments.</li>\n<li>Faster release cycles.</li>\n</ul>",
  "frontmatter": {
    "meta": {
      "title": "5 Things that should be Automated in a TypeScript/Javascript Monorepo",
      "description": "Spend more time on the beach/golf course with these tips",
      "date": "2023-09-04T00:00:00.000Z",
      "image": "https://res.cloudinary.com/ddospxsc8/image/upload/v1693756658/automation_alcvc3.png",
      "tags": ["github-actions", "continuous-integration", "devops"]
    }
  }
}
